{% extends 'social/layout.html' %}
{% load static%}
{% block content%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>


    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="scripts.js"></script>
    <script src="https://kit.fontawesome.com/82cfdc2825.js" crossorigin="anonymous"></script>
</head>
<style>
    body {

        background: url(https://media.kasperskydaily.com/wp-content/uploads/sites/87/2021/02/10134843/tales-from-steam-featured.jpg);
        font-family: 'Times New Roman', Times, serif;
    }

    .main-head {

        background: cyan;
        color: black;
    }

    .main {
        background: cyan;
        color: black;
        width: 60%;
        margin: 5% auto;
        border-radius: 4px;
        padding-bottom: 20px;
    }

    input {
        width: 55%;
        border: 0;

        outline: 0;
        background: cyan;
        padding: 20px 0 4px;
        margin: 0 0 20px;
        color: black;
    }

    img.profile {
        height: 80px;
        width: 80px;
        margin-right: 10px;
        margin-left: 30px;
        border-radius: 50%;
    }
</style>
<script language="javascript" type="text/javascript">
    function exefunction() {
        var lfckv = document.getElementById("lifecheck").checked;
        alert(lfckv);
    }
</script>

<body>
    {%if messages %}
    {% for message in messages %}
    {{message}}
    {% endfor %}
    {% endif %}
    <div class="profile" enctype="multipart/form-data">

        {% for per in per %}

        {%if request.user == per.user %}
        <img src="{{ per.imagen_profile.url }}">
        {% endif %}

        {% endfor %}



        {% if request.user.is_authenticated %}
        <h2>{{ request.user.username }}</h2>
        <h4>{{ request.user.email }}</h4>
        {% endif %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %} <!--genera un token CSRF -->

            <center>
                {% for per in per %}
                {%if request.user == per.user %}
                <label for="image">Imagen de Perfil Actual:</label> <br>
                <img src="{{ per.imagen_profile.url }}"><br> <br>
                {% endif %}
                {% endfor %}
            </center>
            <label for="new_image">Cambiar Imagen de Perfil:</label> <br>
            <input type="file" id="imagenField" name="imagen_profile" placeholder="Ingrese imagen" accept="image/*"><br>

            <!--
            <label for="extra">Información Adicional:</label>
            <textarea id="extra" name="extra">{{ datos.extra }}</textarea><br>-->


            <button type="submit" onclick="actualizacion()" id="checkout">Guardar cambios</button>
        </form>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
            crossorigin="anonymous"></script>

    </div>

    <script>

        function actualizacion() {
            var formData = new FormData();
            formData.append('imagen_profile', $('#imagenField')[0].files[0]); // Acceder al archivo seleccionado

            $.ajax({
                url: "{% url 'datos' %}",
                type: "POST",
                data: formData,
                processData: false, // Evita que jQuery procese los datos
                contentType: false, // Evita que jQuery establezca el tipo de contenido
                headers: {
                    'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val() // Agrega el token CSRF como encabezado
                },
                success: function (response) {
                    // Maneja la respuesta del servidor aquí
                },
                error: function (error) {
                    // Maneja los errores aquí
                }
            });
        }
    </script>




</body>

</html>




{% endblock %}